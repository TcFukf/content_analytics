
using social_analytics;
using social_analytics.Bl;
using social_analytics.Bl.structures;
using social_analytics.DAL;
using System.Diagnostics.SymbolStore;
using System.Reflection;
using System.Text;
using System.Text.RegularExpressions;
using Telegram.Td.Api;
using TelegramWrapper.Gpt_imitator;
using TelegramWrapper.Helpers;
using TelegramWrapper.Models;
using TelegramWrapper.TelegramParser;
using TelegramWrapper.Wrapper;
using TelegramWrapper.Wrapper.Bl;
using TelegramWrapper.Wrapper.Bl.Handlers;
using static System.Net.WebRequestMethods;
// See https://aka.ms/new-console-template for more information
Console.WriteLine("Hello, World!");
//zlib1.dll
//libssl-3-x64.dll
//libcrypto-3-x64.dll
//Assembly.LoadFrom("./libs/Telegram.Td.dll");
//Assembly.LoadFrom("./libs/libssl-3-x64.dll");
//Assembly.LoadFrom("./libs/libcrypto-3-x64.dll");
//Assembly.LoadFrom("./libs/zlib1.dll");



IClientWrapper tg = new TelegramClient(
                                       TelegramWrapper.Helpers.ConfigHelper.ApiId,
                                       TelegramWrapper.Helpers.ConfigHelper.ApiHash,
                                       new ContextManager()
                                       );
tg.InitAndWaitAuthorize();
Parser pars = new Parser(tg);
MessageDAL dal = new MessageDAL();
foreach (var chatId in tg.GetChats().Result)
{
    var messages = pars.GetMessages(chatId,500).Result.Select(tgm=>ModelConverter.FromTelegramMessageToWrapped(tgm))?.ToArray();
    dal.InsertMessages(messages).Wait();
}



static void Print<T>(IEnumerable<T> arr)
{
    Console.WriteLine(string.Join(", ", arr));
}
static void PrintLimit<T>(IEnumerable<T> arr, int limit, string sep = "\n")
{
    int count = 0;
    foreach (var item in arr)
    {
        if (count > limit)
        {
            break;
        }
        count++;
        Console.Write(item + ", " + sep);
    }
    Console.WriteLine();
    Console.WriteLine();
    Console.WriteLine();
}

//(и, 3697, 4213776596757),
//(в, 3115, 4038721718584),
//(не, 2310, 2726432225136),
//(на, 1999, 2790672320864),
//(я, 1980, 940509507835),
//(а, 1630, 523278810962),
//(что, 1594, 661615016227),
//(с, 1441, 0798168880867),
//(это, 1021, 3357241359864),
//(как, 970, 4844881478033),
//(у, 950, 4997393230608),
//(ты, 864, 6766373990619),
//(то, 828, 6758413514972),
//(по, 739, 7033783372457),
//(ну, 661, 6854055960135),
//(да, 597, 0743299401352),
//(за, 591, 3246079874646),
//(так, 589, 6822880969366),
//(но, 541, 22624611866),
//(к, 524, 526558720004),
//(он, 514, 671832207169),
//(меня, 487, 84395031566254),
//(если, 482, 6415507200021),
//(вы, 480, 1776546665121),
//(все, 479, 3562520353013),
//(мне, 450, 61127332313436),
//(из, 446, 2308143752962),
//(нет, 429, 53174336144474),
//(от, 408, 45182268625445),
//(или, 389, 0150262720627),
//(же, 369, 3041737756218),
//(для, 368, 48284967224504),
//(net, 350, 41445112295276),
//(есть, 344, 66582123037335),
//(его, 336, 178935857086),
//(там, 322, 49105902777734),
//(вот, 320, 3009984147246),
//(говорит, 318, 1107828490614),
//(мужик, 298, 3999857122391),
//(кто, 291, 00839827279185),
//(только, 287, 9969299243764),
//(бы, 279, 2366365667162),
//(тебя, 273, 4878991027657),
//(уже, 266, 6438047175315),
//(3, 258, 4308126283771),
//(2, 255, 96699544382778),
//(тебе, 252, 9554724210886),
//(опыт, 251, 03912632054795),
//(тут, 250, 7657257362178),
//(мы, 243, 92133589074507),
//(будет, 242, 2789789028306),
//(работы, 235, 98215728831715),
//(до, 233, 5183848150276),
//(о, 224, 21076148662337),
//(вас, 223, 93688918585144),
//(просто, 215, 4549418440436),
//(https, 211, 34502532857624),
//(1, 209, 15398460721744),
//(когда, 204, 77356679545238),
//(можно, 200, 3936678713457),
//(чтобы, 196, 013220693771),
//(почему, 194, 64440054409664),
//(ему, 191, 08544478825107),
//(она, 190, 26411994187146),
//(про, 188, 89556050537453),
//(вам, 176, 30238797855395),
//(было, 174, 65984817514368),
//(c, 174, 11213779089556),
//(тоже, 172, 1960764595288),
//(они, 170, 27958107217927),
//(где, 170, 27957393421084),
//(может, 168, 36323474352383),
//(еще, 168, 08965378192553),
//(один, 167, 26816343529995),
//(надо, 166, 7207143588012),
//(раз, 160, 6978749905049),
//(чем, 154, 4014170977624),
//(com, 150, 57064640355512),
//(через, 148, 65250118363858),
//(сейчас, 148, 65245333406853),
//(офис, 147, 83118855798696),
//(лет, 146, 1887608495006),
//(спрашивает, 143, 9985001087801),
//(4, 143, 9984518947877),
//(день, 143, 45097382814683),
//(очень, 139, 89216970218143),
//(какой, 139, 61854307720353),
//(нас, 139, 34451122590377),
//(без, 137, 15446970341668),
//(вообще, 134, 96439381232574),
//(могу, 134, 41689081210657),
//(такое, 133, 04896120995548),
//(5, 132, 50054049294562),
//(их, 132, 50049110966884),
//(формат, 130, 31031092220104),
//(был, 127, 02530399343283),
//(всё, 125, 93025300404776),
//(вакансия, 123, 74030275016729),
//(больше, 123, 19262862317659),
//(два, 122, 09752849466727),
//(че, 121, 55031594491204),
//(всем, 121, 55011902776828),
//(ещё, 121, 55008116513027),
//(потом, 121, 55004694183435),
//(после, 120, 45499061239452),
//(core, 119, 90753672960784),
//(знаю, 119, 63380153590158),
//(со, 118, 81239374134823),
//(тогда, 118, 53875718613727),
//(хочу, 116, 62242350540713),
//(привет, 116, 62239998405136),
//(делать, 115, 52730932498555),
//(ли, 114, 97979668348367),
//(человек, 114, 15848610126463),
//(даже, 111, 9684139869533),
//(такой, 109, 77835946645718),
//(время, 108, 13576886610028),
//(быть, 107, 31446025927083),
//(?, 106, 77278235224487),
//(жена, 104, 30308608487212),
//(потому, 101, 29176041205629),
//(разработки, 100, 19658010652337),
//(него, 99, 1016161990628),
//(во, 96, 0902492233829),
//(идет, 95, 81645971399598),
//(чего, 94, 17393369074728),
//(давай, 93, 35275310349168),
//(сам, 93, 0788969391035),
//(input, 92, 80506476134387),
//(sql, 91, 16250785781935),
//(себя, 90, 6149918800886),
//(ничего, 90, 34126558075806),
//(себе, 89, 79373731057645),
//(тот, 89, 7937036687295),
//(пока, 89, 52001214426106),
//(который, 89, 24618462646951),
//(ответа, 88, 97241365412813),
//(конечно, 88, 69882792251566),
//(приходит, 88, 69867081221646),
//(знание, 88, 69860278245402),
//(вопрос, 88, 15120714360461),
//(пожалуйста, 88, 15116860869628),
//(под, 87, 87736498005253),
//(теперь, 87, 60392794330515),
//(context, 87, 32985177073314),
//(хуй, 86, 78240874170193),
//(вдруг, 86, 78234167384836),
//(спасибо, 86, 50865256837604),
//(сколько, 86, 50859021915839),
//(компании, 85, 96104265518153),
//(этот, 84, 59226806552327),
//(лучше, 83, 49725035186019),
//(сообщение, 83, 36029665844441),
//(нахуй, 82, 67597785130755),
//(asp, 82, 40216233584515),
//(стоит, 81, 58087621365868),
//(блять, 80, 21215942992394),
//(много, 79, 93851455405544),
//(000, 79, 93831038118007),
//(сегодня, 78, 843332814359),
//(этого, 78, 56951398216593),
//(нибудь, 78, 02200535380506),
//(нужно, 77, 74821387110232),
//(буду, 76, 92697623177664),
//(папа, 76, 65320918126976),
//(всех, 76, 37942730549464),
//(понял, 76, 10572936881314),
//(ее, 75, 83189626365402),
//(and, 75, 55837435022443),
//(хорошо, 74, 46316028042993),
//(зачем, 74, 46312244467934),
//(бля, 73, 9156664039591),
//(ни, 73, 91556786172549),
//(10, 72, 5468021253016),
//(сказал, 72, 27303809047477),
//(этом, 72, 27299108700923),
//(которые, 72, 27298488172977),
//(мой, 71, 72564770865644),
//(отвечает, 71, 45171973249228),
//(работать, 71, 45171965352625),
//(мама, 71, 17796364760441),
//(ответ, 71, 17794110702728),
//(москва, 70, 63053777791569),
//(компания, 70, 63045883832741),
//(работа, 70, 63040685105463),
//(т, 70, 08307373681627),
//(всегда, 70, 08292179404594),
//(подходит, 70, 08288984068594),
//(лесу, 69, 80913249322596),
//(резюме, 69, 53560075288871),
//(женщина, 69, 53539588272542),
//(три, 68, 98789812338445),
//(твой, 68, 71408253522878),
//(том, 68, 44032880167049),
//(какие, 68, 1667786339499),
//(года, 67, 8928470451713),
//(при, 67, 61908269559615),
//(более, 67, 61903311919035),
//(вопросы, 67, 34532040439207),
//(люди, 67, 34531113942073),
//(писать, 66, 79777187223507),
//(домой, 65, 70273848318112),
//(того, 65, 42921442839025),
//(пиздец, 65, 42904685930031),
//(www, 65, 15565131119898),
//(заходит, 65, 15522163164101),
//(зп, 64, 60767115573438),
//(типа, 63, 51267836558185),
//(текст, 63, 51259923598858),
//(100, 63, 23886115258003),
//(них, 62, 965302840899106),
//(какая, 61, 87008733398558),
//(разработка, 61, 870022612204885),
//(сидит, 61, 322530127190774),
//(7, 60, 77522607058696),
//(каждый, 60, 50128739278132),
//(муж, 60, 22751146752183),
//(чат, 59, 95404782488749),
//(опять, 59, 95375909327189),
//(работу, 59, 95374035733218),
//(ладно, 59, 688583870104274),
//(здесь, 59, 679988626649475),
//(руки, 59, 40619807732466),
//(to, 59, 13276492416195),
//(моя, 58, 858699893351144),
//(senior, 58, 58494149342315),
//(такого, 58, 584917590098854),
//(a, 57, 21621998412011),
//(вроде, 57, 21614658545191),
//(значит, 57, 21613359881684),
//(доктор, 56, 94239089174134),
//(8, 56, 942390233424206),
//(была, 56, 942358497942145),
//(кого, 56, 942357606181595),
//(сука, 56, 394911774325735),
//(хоть, 56, 12112629682038),
//(её, 56, 121070323029706),
//(youtube, 55, 84778752497997),
//(нам, 55, 84732011112476),
//(сын, 55, 57357836004832),
//(куда, 55, 57357060673222),
//(сразу, 55, 573559097524715),
//(всего, 55, 299793412344634),
//(год, 55, 026039090888595),
//(дело, 54, 75230168643502),
//(девушка, 54, 75226344143758),
//(middle, 54, 204747521277625),
//(второй, 53, 931007809651184),
//(либо, 53, 657251316708944),
//(вилка, 52, 83592377664408),
//(первый, 52, 288438921124246),